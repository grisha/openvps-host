#
# Copyright 2004 OpenHosting, Inc.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# $Id: dft.py.in,v 1.24 2004/10/27 02:35:00 grisha Exp $

""" Configuration Defaults

DO NOT EDIT THIS FILE. To change settings, edit your configuration
file. This file is by default /usr/local/etc/ohhost.conf (look below
for CONFIG_FILE for the exact value).

"""

import os, sys

PREFIX = '@prefix@' 

# The main oh directory
OH_DIR = os.path.join(PREFIX, 'oh')

# Configuration directory
CONFIG_DIR = '/etc'

# Configuration file
CONFIG_FILE = os.path.join(CONFIG_DIR, 'ohhost.conf')

# Miscellaneous dir
MISC_DIR = os.path.join(PREFIX, 'oh/misc')

# used below for values that must come from the config file
NOVAL = 'NO VALUE SET - edit %s' % CONFIG_FILE

# Location of miscellaneous files, particularly ping and traceroute
# that later on are copied into a reference vserver
OH_MISC = os.path.join(OH_DIR, 'misc')

# Location of ohchkpwd script used by the web interface panel to
# verify vserver account passwords
OHCHKPWD = os.path.join(PREFIX, 'sbin', 'ohchkpwd')

# Location of vservers config and lib
ETC_VSERVERS = '/etc/vservers'  # XXX needs to be set by ./configure
VSERVER_PREFIX = '/usr/local'   # XXX needs to be set by ./configure
VSERVER_LIB = os.path.join(VSERVER_PREFIX, 'lib/util-vserver')
VSERVER_STAT = os.path.join(VSERVER_PREFIX, 'sbin/vserver-stat')
VSERVER = os.path.join(VSERVER_PREFIX, 'sbin/vserver')

# Location of context disk limit tool (vdlimit)
VDLIMIT = os.path.join('@VDLIMIT_DIR@', 'vdlimit')

# The partition where vservers live
VSERVERS_ROOT = NOVAL

# Location of the vservers database
VAR_DB_OH = '/var/db/oh'

# Location of the backups partition
BACKUP = NOVAL

# Peer ip (the server to which we backup)
PEERIP = '127.0.0.1'

# DSA key that allows login to peer as ohbackup
OHB_DSA_KEY = '@prefix@/etc/ohbackup_dsa'

# User used to login to remote server for backup
BACKUP_USER = 'ohbackup'

# default inodes per vserever allowed
INODES_LIM = 1000000

# default domain name - the hostname for vservers will be
# vservername + this domain
DEFAULT_DOMAIN = 'domain.tld'

# When cloning a reference server, these rules dictate
# what is done. Default action is to hardlink, unless
# any of the paths below match:
#  'copy' - copy files
#  'touch' - copy just the file, not its data
#  'skip' - ignore it
#
# NOTE that the config will compile these and turn CLONE_RULES
# into a triple of (copy, touch, skip) re objects.

CLONE_RULES = {
    'copy' : ['/etc', '/var', '/root', '^/dev'],
    'touch' : ['/var/log', '/var/run', '\.bash_history'],
    'skip' : ['ssh_host_', '.pem$', '/proc/', '/var/tmp/', '/var/cache/.*/.+'] 
    }

# location of chroot command

CHROOT = '/usr/sbin/chroot' # XXX conf

# location of rrdtool

RRDTOOL = '/usr/bin/rrdtool' # XXX conf

# The /etc/motd file

MOTD = """

    Welcome to your new OpenHosting Virtual Server!

"""

# The initial index.html placed into the servers. This should probably
# be a page with a link to the explanation of what to do with a new
# server.

INDEX_HTML = """
    <html>
      <title>OpenHosting Virtual Server</title>
      <center>
         <h2>This site is under construction</h2>
      </center>
      </html>
      """ # keep emacs happy "

# Default nice.
DFT_NICE = '9' # not as nice as default (10), but nice

# Vserver flags
DFT_FLAGS = 'lock\nhide_netif\nvirt_uptime\nsched_hard\nfakeinit\n'

# Scheduler parameters. This only has effect when the sched_hard flag
# is set. Every <interval> (in jiffies ~10ms), a <fill-rate> tokens is
# added to the token bucket. At each timer tick a running process
# consumes a token (to start python is ~16 tokens). If the bucket gets
# empty, the conext is placed on hold queue until <min-tokens> is in
# the bucket. A bucket can accumulate up to <max-token> tokens.
# Another important tip from Sam Vilain: fr / int * 100 = % cpu
DFT_SCHED = {'fill-rate': 30,
             'interval': 100,
             'tokens': 1000,
             'tokens-min': 30,
             'tokens-max':1000}

# Device on which vservers get their IPs
DFT_DEVICE = 'eth0'

# Which "commands" are allowed to run with elevated capabilities and
# what are those caps. The path is absolute inside a vserver.
# Capability names can be found in /usr/include/linux/capability.h

COMMAND_CAPS = {
    # ping already works in 1.9.3 without special tricks
    'TRACEROUTE' : ['/usr/libexec/oh/traceroute', ['NET_RAW']],
    'MOUNT_BIND': ['/usr/libexec/oh/mount', ['SYS_ADMIN']],
    'UMOUNT': ['/usr/libexec/oh/umount', ['SYS_ADMIN']],
    }

# The username used for the commands above
OHD_USER = '@OHD_USER@'

# The port on which sshd listens for these commands
OHD_PORT = '@OHD_PORT@'

# services we want enabled (everything else is disabled)
FEDORA_C2_SRVCS =  ['crond', 'atd', 'httpd', 'sendmail', 'sshd',
                   'syslog', 'webmin', 'dovecot']
# these aren't really services, but are in /etc/init.d
FEDORA_C2_NOT_SRVCS = ['functions', 'killall', 'halt', 'single']

# How many IO intensive operations (e.g. during cloning) we do before
# sleeping. (ops, seconds)

PACE = (1000, 0)

# temporary location on the host server to store remote RPM's
RPM_CACHE = '/var/tmp/openvps-rpmcache'

# This a dictionary with three lists: BASE (I and II) and ADDL.
# BASE is installed first, then ADDTL.


FEDORA_C2_PKGS_BASE_I = [
#    'hwdata',
    'setup',
    'basesystem',
    'tzdata',
    'glibc',
    'bzip2-libs',
    'e2fsprogs',
    'ethtool',
    'glib',
#    'hdparm',
    'libattr',
    'libstdc++',
    'gmp',
    'mingetty',
    'bash',
    'fedora-release',
    'libselinux',
#    'MAKEDEV',
    'less',
    'pcre',
    'perl-Filter',
    'psmisc',
    'rootfiles',
    'shadow-utils',
    'newt',
#    'hotplug',
    'words',
    'zlib',
    'info',
    'diffutils',
    'findutils',
    'grep',
    'ash',
    'gzip',
    'modutils',
    'procps',
#    'lvm2',
#    'pyxf86config',
    'rpm',
    'dev',
#    'kudzu',
    'sysklogd',
    'tar',
#    'mkinitrd',
    'initscripts',
#    'policy',
    'cyrus-sasl',
    'openldap',
    'passwd',
    'authconfig',
#    'system-config-mouse',
    'man-pages',
#    'dump',
    'bind-libs',
    'dosfstools',
    'elfutils',
    'hesiod',
    'lha',
    'acl',
    'lsof',
    'bzip2',
    'anacron',
    'nc',
    'pam_smb',
    'aspell',
#    'fbset',
    'procmail',
    'rdist',
    'rsync',
#    'setarch',
#    'netconfig',
    'setuptool',
    'star',
    'symlinks',
    'tcp_wrappers',
    'tmpwatch',
    'unix2dos',
#    'wireless-tools',
    'gpm',
    'groff',
    'libxml2',
    'make',
#    'minicom',
    'mtools',
    'nscd',
    'libwvstreams',
    'pinfo',
    'bc',
    'lftp',
    'libxml2-python',
    'python-optik',
    'rpm-python',
    'sudo',
    'tcsh',
    'utempter',
    'wget',
#    'apmd',
#    'dhclient',
#    'iptables',
#    'libpcap',
    'openssh-clients',
    'openssh-server',
#    'pcmcia-cs',
#    'nfs-utils',
#    'quota',
#    'system-config-securitylevel-tui',
#    'vconfig',
#    'wvdial',
#    'yp-tools',
    'cyrus-sasl-plain',
    'gnupg',
    'policycoreutils',
    'sendmail',
#    'up2date',
#    'comps',
#    'fedora-logos',
    'libgcc',
    'filesystem',
    'termcap',
    'glibc-common',
    'beecrypt',
    'chkconfig',
    'elfutils-libelf',
    'gdbm',
    'glib2',
    'iputils',
    'libacl',
    'db4',
    'libtermcap',
    'mktemp',
    'cracklib',
    'iproute',
#    'device-mapper',
    'ncurses',
    'net-tools',
    'perl',
    'popt',
#    'raidtools',
#    'setserial',
    'slang',
#    'usbutils',
    'vim-minimal',
    'cracklib-dicts',
    'file',
    'cpio',
    'ed',
    'gawk',
    'coreutils',
#    'grub',
    'krb5-libs',
    'openssl',
    'readline',
    'python',
#    'rhpl',
    'sed',
    'pam',
#    'policycoreutils',
    'SysVinit',
    'util-linux',
    'which',
#    'kernel',
#    'prelink',
    'cyrus-sasl-md5',
    'libuser',
    'usermode',
#    'kbd',
    'mailcap',
#    'rmt',
    'specspo',
    'dos2unix',
#    'eject',
    'finger',
#    'krbafs',
    'attr',
    'lrzsz',
    'mailx',
    'crontabs',
#    'mt-st',
    'mtr',
    'pax',
    'aspell-en',
    'logrotate',
#    'rdate',
    'rsh',
#    'schedutils',
#    'lockdev',
    'ntsysv',
    'slocate',
#    'statserial',
    'talk',
    'telnet',
    'traceroute',
    'unzip',
    'zip',
    'at',
    'jwhois',
    'logwatch',
    'man',
#    'irda-utils',
    'nano',
    'bind-utils',
#    'pam_krb5',
    'psacct',
    'ftp',
#    'parted',
    'pyOpenSSL',
#    'rhnlib',
    'stunnel',
#    'syslinux',
    'time',
#    'mkbootdisk',
#    'acpid',
#    'devlabel',
#    'isdn4k-utils',
#    'kernel-utils',
    'openssh',
#    'netdump',
#    'pciutils',
    'portmap',
#    'ppp',
#    'rp-pppoe',
#    'tcpdump',
    'vixie-cron',
#    'ypbind',
    'yum',
#    'autofs',
    'nss_ldap',
#    'mdadm',
#    'system-config-network-tui',
    'expat',
    'm4',
    'vim-common',
    'http://www.openvps.org/dist/misc/openvps-bogus-kernel-2.9.0-1.i386.rpm',
    ]

FEDORA_C2_PKGS_BASE_II = [
    'pkgconfig',
    'perl-HTML-Parser',
#    'perl-Cyrus',
#    'cyrus-imapd-utils',
    'cyrus-sasl-devel',
    'dovecot',
    'php',
    'mysql-devel',
    'apr-util-devel',
    'postgresql-devel',
    'glibc-kernheaders',
    'postgresql-contrib',
    'gd',
    'apr',
    'freetype-devel',
    'php-mysql',
    'postgresql-jdbc',
    'postgresql-docs',
    'php-devel',
    'httpd-devel',
    'php-domxml',
    'openssl-devel',
    'gdbm-devel',
    'spamassassin',
    'mysql-server',
    'libtool-libs',
    'perl-Digest-HMAC',
    'libxslt',
    'mysql',
    'php-pear',
    'e2fsprogs-devel',
    'curl',
    'rpm-build',
    'mod_ssl',
    'perl-Time-HiRes',
    'postgresql-libs',
    'php-pgsql',
    'libc-client',
    'libstdc++-devel',
    'vim-enhanced',
    'libtool',
    'zlib-devel',
    'perl-libwww-perl',
    'postgresql-python',
    'perl-Net-DNS',
    'samba-common',
    'rpm-devel',
    'postgresql-test',
    'krb5-devel',
    'postgresql-tcl',
    'fetchmail',
    'openldap-devel',
    'db4-devel',
    'perl-DBI',
    'mx',
    'cpp',
    'postgresql-server',
    'gcc-c++',
    'gd-devel',
    'perl-XML-Parser',
    'php-imap',
    'samba-client',
    'perl-DBD-MySQL',
    'binutils',
    'postgresql-pl',
    'curl-devel',
    'gcc',
    'autoconf',
    'tcl',
    'libjpeg',
    'tcl-devel',
    'postgresql',
    'perl-DBD-Pg',
    'samba',
    'apr-devel',
    'perl-URI',
    'php-ldap',
    'telnet-server',
#    'cyrus-imapd',
    'libpng',
    'squid',
    'php-xmlrpc',
    'freetype',
    'perl-Digest-SHA1',
    'expat-devel',
    'rcs',
    'glibc-headers',
    'webalizer',
    'glib-devel',
    'apr-util',
    'xorg-x11-devel',
    'libtiff',
    'perl-HTML-Tagset',
    'distcache',
    'glibc-devel',
    'patch',
    'python-devel',
    'cvs',
    'fontconfig',
    'xinetd',
    'automake',
    'httpd',
    'samba-swat',
#    'php-mbstring',
    'mkinitrd',
    'fontconfig-devel',
    'cups-libs',
    'bind-chroot',
    'http://www.openvps.org/dist/misc/openvps-bind-9.2.3-13.i386.rpm',
    'http://www.openvps.org/dist/misc/mirror/perl-Net-SSLeay-1.23-0.rhfc1.dag.i386.rpm',
    'xorg-x11-libs',
    'device-mapper',
    'xorg-x11-libs-data',
    'lvm2',
    'xorg-x11-Mesa-libGL',
    'mod_perl',
    'mod_python',
    'emacs-common',
    'libungif',
    'Xaw3d',
    'http://www.openvps.org/dist/misc/mirror/perl-Net-SSLeay-1.23-0.rhfc1.dag.i386.rpm',
    'http://www.openvps.org/dist/misc/mirror/proftpd-1.2.9-7.i386.rpm',
    'http://www.openvps.org/dist/misc/webmin-1.160-1_OH.noarch.rpm',
    ]

FEDORA_C2_PKGS_ADDL = [ ]

# The organization name for the SSL cert. This is your company name
# and other info.

SSL_ORG_COUNTRY = "US"
SSL_ORG_STATE = "Virginia"
SSL_ORG_NAME = "Some Company, Inc."

SSL_CONFIG = """
HOME= .
RANDFILE = $ENV::HOME/.rnd

[ req ]
default_bits = 1024
encrypt_key = yes
distinguished_name = req_dn
x509_extensions = cert_type

[ req_dn ]
countryName = Country Name (2 letter code)
countryName_default             = NO
countryName_min                 = 2
countryName_max                 = 2
countryName_value               = %s

stateOrProvinceName             = State or Province Name (full name)
stateOrProvinceName_default     = Some-State
stateOrProvinceName_value       = %s

localityName                    = Locality Name (eg, city)
localityName_value              = Vienna

0.organizationName              = Organization Name (eg, company)
0.organizationName_default      = FooBar Inc.
0.organizationName_value        = %s

organizationalUnitName          = Organizational Unit Name (eg, section)
organizationalUnitName_value    = Security Department

0.commonName                    = Common Name (FQDN of your server)
0.commonName_value              = @SSL_HOSTNAME@

1.commonName                    = Common Name (default)
1.commonName_value              = localhost

[ cert_type ]
nsCertType = server
""" % (SSL_ORG_COUNTRY, SSL_ORG_STATE, SSL_ORG_NAME)

HTTPD_CONF = """
<IfModule mod_proxy.c>
  # OpenHosting panel proxy
  ProxyRequests           Off
  ProxyPass               /ohadmin/ http://127.0.0.1:1011/
  ProxyPassReverse        /ohadmin/ http://127.0.0.1:1011/
</IfModule>
"""

RNDSLEEP = """\
#!/bin/bash

# (c) 2004 OpenHosting, Inc.

sleep $(($RANDOM %  ${1:-1}))

"""

CRONTAB = """\
SHELL=/bin/bash
PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/bin
MAILTO=root
HOME=/

#
# NOTE the rndsleep command will sleep a random number of seconds for
# up to the argument given. It is there to prevent virtual servers from
# doing heavy disk IO all at the same time.
#
# BE COURTEOUS, LEAVE IT THERE.
#
01 * * * * root rndsleep 60 && run-parts /etc/cron.hourly
02 4 * * * root rndsleep 1200 && run-parts /etc/cron.daily
22 4 * * 0 root rndsleep 1200 && run-parts /etc/cron.weekly
42 4 1 * * root rndsleep 1200 && run-parts /etc/cron.monthly
"""


# makes emacs go into python mode
### Local Variables:
### mode:python
### End:
